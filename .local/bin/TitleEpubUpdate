#!/bin/bash

# Script to rename epub metadata (title and sort title) based on filename
# Usage: ./rename_epub_metadata.sh [file.epub]
# If no file specified, processes all .epub files in current directory

if [ $# -eq 1 ]; then
    # Process single file
    if [ -f "$1" ] && [[ "$1" == *.epub ]]; then
        filename="$1"
        basename_no_ext=$(basename "$filename" .epub)
        echo "Processing: $filename"
        echo "Setting title and sort title to: $basename_no_ext"
        ebook-meta "$filename" --title="$basename_no_ext" --title-sort="$basename_no_ext"
        echo ""
    else
        echo "Error: File not found or not an epub file: $1"
        exit 1
    fi
else
    # Process all epub files in current directory
    echo "Processing all epub files in current directory..."
    echo ""

    find . -maxdepth 1 -type f -name "*.epub" | while read -r filename; do
        basename_no_ext=$(basename "$filename" .epub)
        echo "Processing: $filename"
        echo "Setting title and sort title to: $basename_no_ext"
        ebook-meta "$filename" --title="$basename_no_ext" --title-sort="$basename_no_ext"
        echo ""
    done

    echo "Done processing all epub files!"
fi
